<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="robert" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>Example 4: Ole Automation - Excel</title>
  <body>
    <header>
      <para styleclass="Heading1">Example 4: Ole Automation - Excel</para>
    </header>
    <para styleclass="Normal"><text styleclass="Body Text">For the 4th example we will not use a standard example from VO but will create a new sample app in VO to remote control Excel and to write data to an Excel Sheet.</text></para>
    <para styleclass="Normal"><text styleclass="Body Text">I found the following example in the Comp.Lang.Clipper.Visual-Objects newsgroup (which I changed a little bit for this example).</text></para>
    <list id="876" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Normal" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Normal"><text styleclass="Body Text">Create a new terminal application in VO and copy and pase the code below into the app.</text></li>
      <li styleclass="Normal"><text styleclass="Body Text">Open the application Properties and add the Ole Library.</text></li>
      <li styleclass="Normal"><text styleclass="Body Text">Also rename the app to &quot;ExcelTest&quot;.</text></li>
      <li styleclass="Normal"><text styleclass="Body Text">Now open the start module and copy the code.</text></li>
      <li styleclass="Normal"><text styleclass="Body Text">Compile and run, and you will find an xls file in the C:\ExcelTest folder.</text></li>
    </list>
    <para styleclass="Normal"></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">FUNCTION</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;"> Start</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">()</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">OBJECT</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;"> oWorkBooks </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">OBJECT</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;"> oWorksheet </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">OBJECT</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;"> oRange </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">OBJECT</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;"> cFile </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">STRING</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">cFile </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;C:\ExcelTest\example.xls&quot;</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">DirMake</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">(</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">String2Psz</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">(</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;C:\ExcelTest&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">))</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">OLEAutoObject</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">{</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;Excel.Application&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">}</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">Visible</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">FALSE</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#008000;">// Don&apos;t show the EXCEL execute</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">DisplayAlerts</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">FALSE</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#008000;">// Don&apos;t show messages</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oWorkBooks</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">Workbooks</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oWorkBooks</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">add</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">()</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#008000;">//open a new worksheet</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oWorkSheet</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">ActiveSheet </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#008000;">// active the first sheet</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oRange</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oWorkSheet</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:[</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">Range</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;A1&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;A1&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">]</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#008000;">// A1 cell</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oRange</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">SELECT</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">()</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oRange</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">FormulaR1C1</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;Hello my text&quot;</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">ActiveWorkBook</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">SaveAs</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">(</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">cFile</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#808080;">56</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">FALSE</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">FALSE</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">)</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;"> &#160;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#008000;">//&quot;56&quot; save the file in work book of EXCEL 97-2003 (Excel 8)</text></para>
    <para styleclass="Normal" style="margin-left:13px;"></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oWorkBooks</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">Close</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">()</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oExcel</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">Quit</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">()</text><tab /></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">WAIT</text></para>
    <para styleclass="Normal" style="margin-left:13px;"></para>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">RETURN</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000;">NIL</text><tab /></para>
    <para styleclass="Normal"></para>
    <list id="877" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text">Export the AEF to &quot;C:\ExcelTest\ExcelTest.AEF&quot;</li>
      <li styleclass="Body Text">Run the VOExporter and export the code.</li>
      <li styleclass="Body Text">After opening the solution inside Visual Studio you will also get an application with one source file (Start.prg). The source is almost identical with one difference. The line :</li>
    </list>
    <para styleclass="Normal" style="margin-left:13px;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oRange</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:=</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">oWorkSheet</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">:[</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">Range</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;A1&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">,</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#0000ff;">&quot;A1&quot;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff00ff;">]</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#008000;">// A1 cell</text></para>
    <para styleclass="Normal" style="margin-left:13px;"></para>
    <para styleclass="Body Text">has been changed to</para>
    <para styleclass="Normal" style="margin-left:13px; line-height:1.15;"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">oRange:=oWorkSheet:Range[&quot;A1&quot;,&quot;A1&quot;] // A1 cell</text></para>
    <list id="878" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text">Note that the name Range is now in front of the Square bracket.<br/>Range is a so called &quot;Index property&quot; of the worksheet. VO uses a &quot;funny&quot; syntax for &#160;this. X# uses the same syntax that most other languages do. The property looks like an array (the square brackets) . </li>
    </list>
    <list id="879" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text">Now compile the app in X#. You will get the following errors:</li>
    </list>
    <para styleclass="Body Text"><image src="ExcelOle.png" scale="100.00%" styleclass="Image Caption"></image></para>
    <para styleclass="Body Text">Let&apos;s look at these errors:</para>
    <list id="880" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text">The last errors in the list indicate that the Start method is not correct. This is because the Start function in .Net has to either be a VOID function or a function that returns an INT. In this case no return type has been declared, so X# thinks you want to create a function that returns a USUAL. Change the prototype of the start function to:<br/><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">FUNCTION Start() AS VOID</text></li>
    </list>
    <para styleclass="Body Text" style="margin-left:13px;">and remove the NIL return value from the RETURN statement.</para>
    <list id="881" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text">Now 2 errors remain. These indicate that X# does not know how to convert the array index from string to int. This is on the line with the range assignment. <br/>The code above uses &apos;Late Binding&apos;, so the types are not known at compile time. X# does not know if the Range property from the Worksheet object is a index property or if it returns an array. It assumes that it returns an array and wants to specify the array index which is numeric.<br/>The best way to fix it is to use strong typing and use the Generated Class wrappers for Excel. <br/>In &#160;VO you would use the &apos;Automation Server&apos; tool to generate such a class wrapper. In .Net there is a similar tool. The easiest way to achieve this is to add a reference to Excel to the references of the application:</li>
      <li styleclass="Body Text">Right Click on &quot;References&quot; in the solution Explorer and Choose &quot;Add Reference&quot;</li>
      <li styleclass="Body Text">In the &apos;Add Reference&apos; dialog, choose the COM tabpage</li>
      <li styleclass="Body Text">Locate the &quot;Microsoft Excel nn.m Object Library&quot;:</li>
    </list>
    <para styleclass="Body Text"><image src="ExcelAddRef.png" scale="68.26%" width="561" height="369" styleclass="Image Caption"></image></para>
    <list id="881" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text"><text styleclass="Image Caption" style="font-style:normal;">Click Ok.</text></li>
      <li styleclass="Body Text"><text styleclass="Image Caption" style="font-style:normal;">This will add an entry to your References list with the name &quot;Microsoft.Office.Interop.Excel&quot;. This is a generated type library that contains class definitions for all types inside Excel.</text></li>
      <li styleclass="Body Text"><text styleclass="Image Caption" style="font-style:normal;">Now go into your code, add a Using statement for the namespace of the Excel classes and change &quot;AS OBJECT&quot; to the right types:</text></li>
    </list>
    <para styleclass="Normal" style="margin-left:13px;"><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">USING</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> Microsoft.Office.Interop.Excel</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">FUNCTION</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> Start() </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> VOID</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> oExcel </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> Application</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> oWorkBooks </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> Workbooks</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> oWorksheet </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> Worksheet</text></para>
    <para styleclass="Normal" style="margin-left:13px;"><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">LOCAL</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> oRange </text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#ff0000; background-color:#ffffff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;"> Range</text></para>
    <para styleclass="Normal" style="margin-left:13px;"></para>
    <list id="881" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text"><text styleclass="Image Caption" style="font-style:normal;">Also change the call to create the Main Excel object:</text></li>
    </list>
    <para styleclass="Normal"><tab /><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">oExcel:=ApplicationClass{}</text><br/></para>
    <list id="882" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Normal" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Normal"><text styleclass="Body Text">Your code is now strongly typed, so you should also get intellisense if you try to select a member from one of these objects, such as oExcel:Workbooks.</text></li>
    </list>
    <list id="883" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Body Text">Compile and run the code . It works as expected.</li>
      <li styleclass="Body Text">You may want to change the value <text style="font-weight:bold;">56</text> in the <text style="font-weight:bold;">SaveAs</text> line to the appropriate enum value: <text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">xlFileFormat.xlExcel8</text></li>
      <li styleclass="Body Text">Now run the app again and everything works as expected.</li>
      <li styleclass="Body Text">If you look in the folder where the EXE is generated you will see both ExcelTest.Exe and Microsoft.Office.Interop.Excel.dll, the type library</li>
    </list>
    <para styleclass="Heading2">Note 1</para>
    <para styleclass="Body Text">If you are wondering why we declare oExcel as Application but use ApplicationClass to instantiate the object, here is the reason:</para>
    <para styleclass="Body Text"><text style="font-weight:bold;">Application</text> is the interface, <text style="font-weight:bold;">ApplicationClass</text> is the actual class that implements the Application interface. This is a model that you will see for most Automation Servers.</para>
    <para styleclass="Heading2">Note 2</para>
    <para styleclass="Normal">Many people have asked for a way to implement OLE Events. With the X# code and the generated type library this is very easy.</para>
    <para styleclass="Normal">Add the following code to the start method to define a BeforeSave and AfterSave event</para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">oExcel:WorkbookBeforeSave += OnBeforeSave</text></para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">oExcel:WorkbookAfterSave += OnAfterSave</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Body Text">and add the following functions</para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">FUNCTION OnBeforeSave (oWb AS Workbook, SaveAsUI AS LOGIC, Cancel REF Logic) AS VOID</text></para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">? &quot;OnBeforeSave&quot;, oWb:Path, oWb:Name, SaveAsUI</text></para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">RETURN</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">FUNCTION OnAfterSave (oWb AS Workbook, Success AS LOGIC) AS VOID</text></para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">? &quot;OnAfterSave&quot;, oWb:Path, oWb:Name, Success</text></para>
    <para styleclass="Normal"><text styleclass="" style="font-family:Consolas; font-size:12pt; color:#000000; background-color:#ffffff;">RETURN</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Body Text">And run the example again. You will see that both functions are called. Before the save the path and name are not set properly, afterwards they are set to the values specified in the code</para>
  </body>
</topic>
